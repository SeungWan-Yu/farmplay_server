<style>
    #selectView{max-height: 780px; overflow-y: auto;} 
    #apiInfoView{max-height:600px; min-height: 200px; overflow-y: auto;}
    #apiResultView{max-height: 280px; overflow-y: auto;}
    .apiLine{cursor: pointer;}
    #selectTable{width: 100%;}
    #selectTable th{position: sticky; top: 0; z-index: 1; background-color: #3a3b45; color: white;}
    #sendBtn{width: 400px;}
    .hide{display: none !important;}
</style>

<script type="text/javascript">

    $(function(){
        
        //**넘어온 데이터 json으로 변환 
        var data = JSON.parse('<%-JSON.stringify(data)%>'); 
       
        //**선택한 api 인덱스,선택된데이터.. 전역변수 선언
        var index;      
        var selectData;
        var reqParamList;
        var reqParamKorList;

        console.log("데이터체크");
        console.log(data)

        //**왼쪽 api선택 영역 리스트 전달
        var leftHtml='';
        for(i in data){
            leftHtml += '<tr class="bg-gray-100 apiLine getApiCls">';
            leftHtml += '<td><div class="p-3">'+data[i].apiName+'</div></td>';
            leftHtml += '<td><div class="p-3">'+data[i].apiExplan+'</div></td>';
            leftHtml += '<td><div class="p-3">'+data[i].apiUrl+'</div></td>';
            leftHtml += '</tr>';
        }
        $('#selectTable tbody').append(leftHtml);


        //**api결과 리셋함수
        function apiResultReset(){
            $('.p-3_result').text("");
            $('.p-3_return').text("");
        }

    
        //** api명 또는 설명 클릭이벤트
        $('.getApiCls').click(function(){
            index = $(this).index();    //클릭한 인덱스
            $('#sendBtn').removeClass('hide');  //버튼보이기
            //리셋
            apiResultReset();
            $('.apiInfoViewBody').css('display','none');                
            $('.getApiCls').attr('class','bg-gray-100 apiLine getApiCls');
            $('#contentTable tbody tr').remove();
            //클릭한값 색칠
            $(this).attr('class','bg-gray-300 apiLine getApiCls');

            //클릭한값에 따른 전역변수 값 세팅
            var rightHtml='';
            selectData =  data[index];
            var reqParam = selectData.apiReqParam;
            var reqParamKor = selectData.apiReqParamKor;
            reqParamList = reqParam.split(',');
            reqParamKorList = reqParamKor.split(',');
            console.log("리스트체크>>"+reqParamList);
            console.log("리스트길이>>"+reqParamList.length);



            //클릭한값에 따른 오른쪽 화면전달
            for(i in reqParamList){
                if(reqParamList.length<=8){
                    rightHtml += '<tr>';
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[i]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[i]+'"></div></td>';
                    rightHtml += '</tr>';
                }else if(reqParamList.length<=16){
                    rightHtml += '<tr>';
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[2*i]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[2*i]+'"></div></td>';
                    if((reqParamList.length-1)==(2*i))  break;
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[(2*i)+1]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[(2*i)+1]+'"></div></td>';
                    rightHtml += '</tr>';
                    if((reqParamList.length-1)==(2*i)+1) break;
                }else{
                    rightHtml += '<tr>';
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[3*i]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[3*i]+'"></div></td>';
                    if((reqParamList.length-1)==(3*i)) break;
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[(3*i)+1]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[(3*i)+1]+'"></div></td>';
                    if((reqParamList.length-1)==(3*i)+1) break;
                    rightHtml += '<td class="col-lg-2"><div class="p-3">'+reqParamKorList[(3*i)+2]+'</div></td>';
                    rightHtml += '<td><div class="p-3"><input type="text" id="'+reqParamList[(3*i)+2]+'"></div></td>';
                    if((reqParamList.length-1)==(3*i)+2) break;
                    rightHtml += '</tr>';
                }
               
            }
            $('#contentTable tbody').append(rightHtml);
        });

        //** 전송버튼 클릭이베튼 
        $('#sendBtn').click(function(){
            apiResultReset();   //결과 리셋
            var apiMethod = selectData.apiMethod;
            var apiUrl = selectData.apiUrl;

            var keyname = 'Name';
            var something = {
                [keyname] : 'value'
            };
            
            var sendData = {};
            for(i in reqParamList){
                sendData[reqParamList[i]] = $("#"+reqParamList[i]+"").val();
            }

            console.log(sendData);
            
            $.ajax({
                contentType: "application/json; charset=utf-8",
                type:apiMethod,
                dataType:'json',
                data: JSON.stringify(sendData),
                url: apiUrl,
                success: function(data) {
                    $('.p-3_result').text(data.result);
                    $('.p-3_return').text(JSON.stringify(data.message));
                },
                error: function searchError(xhr, err) {
                    alert("에러");
                    alert(err);
                }
            });  
        });
    });
</script>

<h1>회원api</h1>
<div class="row">
    <!-- 왼쪽 api 선택영역 -->
    <div class="col-lg-3" id="selectView">
        <!-- Circle Buttons -->
        <div class="card shadow mb-4">
            <table id="selectTable">
                <thead>
                    <tr>
                        <th><div class="p-3 apiName">api명</div></th>
                        <th><div class="p-3 apiExplain">api설명</div></th>
                        <th><div class="p-3 apiExplain">api주소</div></th>
                    </tr>
    
                </thead>
                <tbody>
     
                </tbody> 
            </table>
        </div>
    
    </div>
    
    <!-- 오른쪽 영역 -->
    <div class="col-lg-9">
        <!-- api정보화면 insert,update,delete는 입력값, select는 테이블  -->
        <div class="card shadow mb-4" id="apiInfoView">

            <!-- 선택한 api별로 변경되는 부분 아래로 쭉이어서 쓰면된다. -->
            <table id="contentTable">
                <tbody>
                </tbody>
            </table>
            <div class="p-3"><button type="button" id="sendBtn" class="btn btn-primary hide">전송</button></div>

            <table class="table table-bordered hide" id="dataTable" width="100%" cellspacing="0">

            </table>

           
        </div>    
         <!-- 통신결과 보여주는 영역  -->
        <div class="card shadow mb-4">           
            <div class="p-3 apiName">● 결과 : <p class="p-3_result"></p></div>
            <div class="p-3 apiName">● 리턴값: <p class="p-3_return"></p></div>
        </div>
    </div>
</div>
